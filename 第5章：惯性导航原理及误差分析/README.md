# 第5章：惯性器件误差分析及标定

## 课程内容

代码、PPT、视频见文件夹

### 课程笔记

#### 惯性器件

机械陀螺：

定轴性：当陀螺转子以高速旋转时，在没有任何外力矩作用在陀螺仪上时，陀螺仪的自转轴在惯性 空间中的指向保持稳定不变，即指向一个固定的方向；同时反抗任何改变转子轴向的力量。 

进动性：当转子高速旋转时，若外力矩作用于外环轴，陀螺仪将绕内环轴转动；若外力矩作用于内 环轴，陀螺仪将绕外环轴转动。其转动角速度方向与外力矩作用方向互相垂直。

惯性器件-激光陀螺  略

惯性器件-光纤陀螺  略

惯性器件-MEMS陀螺 略

惯性器件-加速度计 略

#### 惯性器件误差分析

##### 信号误差组成

1) 量化噪声

一切量化操作所固有的噪声，是数字传感器必然出现的噪声； 产生原因：通过AD采集把连续时间信号采集成离散信号的过程中，精度会损失，精度损失的大小和AD转换的步长 有关，步长越小，量化噪声越小。 

2) 角度随机游走 

宽带角速率白噪声：陀螺输出角速率是含噪声的，该噪声中的白噪声成分； 产生原因：计算姿态的本质是对角速率做积分，这必然会对噪声也做了积分。白噪声的积分并不是白噪声，而是一 个马尔可夫过程，即当前时刻的误差是在上一时刻误差的基础上累加一个随机白噪声得到的。 角度误差中所含的马尔可夫性质的误差，称为角度随机游走。 

3) 角速率随机游走 

与角度随机游走类似，角速率误差中所含的马尔可夫性质的误差，称为角速率随机游走。而这个马尔可夫性质的误 差是由宽带角加速率白噪声累积的结果。

4) 零偏不稳定性噪声 

零偏：即常说的bias，一般不是一个固定参数，而是在一定范围内缓慢随机飘移。

零偏不稳定性：零偏随时间缓慢变化，其变化值无法预估，需要假定一个概率区间描述它有多大的可能性落在这个 区间内。时间越长，区间越大。 1. 信号误差组成 

5) 速率斜坡 

该误差是趋势性误差，而不是随机误差。 随机误差，是指你无法用确定性模型去拟合并消除它，最多只能用概率模型去描述它，这样得到的预测结果也是概 率性质的。 趋势性误差，是可以直接拟合消除的，在陀螺里产生这种误差最常见的原因是温度引起零位变化，可以通过温补来 消除。 

6) 零偏重复性 

多次启动时，零偏不相等，因此会有一个重复性误差。在实际使用中，需要每次上电都重新估计一次。 Allan方差分析时，不包含对零偏重复性的分析

##### Allan方差分析

原理略

开源代码：

https://github.com/gaowenliang/imu_utils

用法(以陀螺仪为例)：
1) 角度随机游走，在融合时作为陀螺仪的噪声使用。
(有时也以零偏不稳定性当做噪声)
2) 角速度随机游走，作为陀螺仪微分项中的噪声
(详细内容在介绍融合时介绍)
注意：
1）其他误差项，仅起到了解器件精度水平的作用；
2）实际融合时，Allan分析的结果，只是作为初值使用，
需要在此基础上调参。

#### 惯性器件内参标定

##### 零偏

误差解释：陀螺仪或加速度计输出中的常值偏移，即常说的 bias。

##### 刻度系数误差

误差解释：器件的输出往往为脉冲值或模数转换得到的值，需要乘以一个刻度系数才能转换成角速度或加速度值，若该系数不准，便存在刻度系数误差。

##### 安装误差

误差解释：如右图所示，b坐标系是正交的imu坐标系，g坐标系的三个轴是分别对应三个陀螺仪。由于加工工艺原因，陀螺仪的三个轴并不正交，而且和b坐标系的轴不重合，二者之间的偏差即为安装误差。

##### 标定方法概述

标定的本质是参数辨识，参数包括陀螺仪和加速度计各自的零偏、刻度系数误差、安装误差。
辨识方法包括：
1）解析法或最小二乘
2）迭代优化方法
3）滤波（Kalman等）
常见标定方法与上面辨识方法的对应关系为：
1) 基于转台的标定: 解析法、最小二乘；
2) 不需要转台的标定: 梯度下降迭代优化；
3) 系统级标定：kalman滤波(该方法只适用于高精度惯导，本课程不做讲解)。

##### 基于转台的标定-加速度计标定

在IMU的误差模型中，陀螺仪和加速度计的误差方程是互相独立的，可分别标定。
以加速度计为例，其误差模型方程为：

![pic1](.\PIC\pic1.jpg)

误差模型方程是一个包含12个未知参数的方程组，显然方程组没有唯一解。此时，通过改变输入，获得多个不同方程（大于12个），组成的方程组便可求解参数。 以上就是分立级标定方法的思路，具体求解方法包括解析法和最小二乘法。

该标定方法的核心：通过旋转IMU，改变其输入构造方程组，并且每个位置对应的加速度输入和角速度输入都必须
是已知的。
构建方程组时，不仅要方程组数量足够，而且要能够使误差参数可解，即系数矩阵可逆。
为了满足这一点，常见的转位方案有六位置、八位置、十二位置等。
在实际使用时，通过判断系数矩阵是否满秩便可判断，理论上，只要转位方案能满足这一条件，就可以使用。

转台需要调平。

解析法：

最小二乘法：

##### 基于转台的标定-陀螺仪标定

方法思想

转台一般角速度不如角度精度高，因此不是直接以角速度作为真值，而是以积分得到的角度作为真值。

解析法(求解刻度系数和安装误差)：

解析法(求解零偏)：

当转台静止时，可以简单认为陀螺仪输出只有零偏，此时采集一段时间内的数据，取平均值，即可得到零偏。

需要强调的是：
a. 有时标定需要考虑地球自转角速度的影响，此时模型比较复杂，可自行参考《惯性仪器测试与数据分析》第 10 章。
b. mems 陀螺仪的零偏重复性极差，因此每次上电都要在线估计零偏，因此离线标定时，零偏标与不标区别不大。

##### 不需要转台的标定

整体思路
加速度输入(重力加速度)是已知的，已知值与测量值的差异作为残差，通过优化，估计内参。

参考资料：
论文：A Robust and Easy to Implement Method for IMU Calibration without External Equipments
代码：https://github.com/Kyle-ak/imu_tk

内参模型

优化模型—估计加速度计内参

一个静止位置的测量不能完全求解出参数，需要按不同的姿态，在多个位置静止(如右图黑色曲线所包含的时间段)，所有位置的测量放在同一个优化任务中，才能求解全部参数。

优化模型—估计陀螺仪内参

##### 标定方法比较

1) 基于转台的标定精度较高，但标定成本高；
2) 不依赖转台的标定精度差，但成本低、效率高，对一般MEMS的标定需求已经足够。

#### 惯性器件温补

温补的本质是系统辨识，既要找出合适的物理模型，又要识别物理模型的参数。

物理模型辨识：

参数辨识
在选定的物理模型基础上做最小二乘曲线拟合，与分立级标定时所用最小二乘原理相同。

其他改进方法
a. 分段拟合
bias随温度变化曲线多是不规则曲线，无法用一个完整的曲线模型做拟合。
常见的方法是按照温度把曲线分成多个区间，每个区间单独拟合一个模型。
b. 基于神经网络
温补最大的问题是物理模型未知，而神经网络不需要已知物理模型，理论上比较合理。
但是实际使用中，由于很多处理器只是简单的嵌入式板子，运算能力有限，而且多项式方法已经能解决大部分
问题，因此这种方法在实际使用中用的不多。

关于温补的讨论
a. 温补在器件误差补偿中是最重要的，但也是最“没有技术含量”的。
b. 温变的本质是和器件整体温度场相关，而不只是和局部温度点相关，但温度传感器只能测量后者。
c. 永远无法找到完全准确的温补模型，但是却能知道什么是够用的。自动控制领域有一句名言 “All models are wrong, but some are useful“

## 作业

按照不需要转台标定方法中所给出的内参模型及残差模型，推导加速度计对应残差对加速度内参的雅可比，在开源代码中按新的内参模型 (开源代码中加速度计内参模型是上三角，本课程模型是下三角)改成解析式求导，并使用课程给定的仿真数据做验证。
评价标准：
1) 及格：完成雅可比推导，且正确；
2) 良好：完成标定，且结果正确，但加速度计的估计未使用解析式求导；
3) 优秀：使用解析式求导完成标定，且结果正确。

代码和文档见文件夹。

注：

安装gnuplot ：

sudo apt-get install gnuplot
